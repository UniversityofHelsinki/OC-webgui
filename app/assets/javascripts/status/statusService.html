angular.module('ocWebGui.status.service', ['ngResource', 'ocWebGui.filterpanel'])
  .factory('Status', function ($resource, shared) {
    var teams = shared.getTeams();
    var states = shared.getStates();
    return $resource('agent_statuses.json', {}, {
      query: {
        method: 'get',
        isArray: true,
        transformResponse: function (data) {
          var status = angular.fromJson(data);
          return status.filter(function (agent) {
            return teams[agent.team] && (states[agent.status] || (states.Muut && !(agent.status in states)));
          });
        }
      }
    });
  });
